var app=angular.module("app",["ui.router"]);app.config(["$httpProvider",function(t,n){t.defaults.withCredentials=!0}]),app.controller("index",function(t,n,s){n.vail().success(function(t){t.hasLogin||sessionStorage.getItem("username")||s.go("login")})}),app.controller("homeCtr",function(t,n,s){n.vail().success(function(n){n.hasLogin&&(t.username=n.name)}),t.exit=function(){n.out().success(function(){sessionStorage.removeItem("username"),s.go("login")})}}),app.controller("navCtr",function(t,n){t.nav=[{sref:"home",on:!0,class:"fa-user",content:"用户管理"},{sref:"home.classifyMan",on:!1,class:"fa-tasks",content:"分类管理"}],n.$$url.indexOf("/classifyMan")==-1?(t.nav[0].on=!0,t.nav[1].on=!1):(t.nav[0].on=!1,t.nav[1].on=!0),t.setOn=function(n){if(1!=t.nav[n].on){for(var s=0;s<t.nav.length;s++)t.nav[s].on=!1;t.nav[n].on=!0}}}),app.controller("loginCtr",function(t,n,s,e){t.success=!0,"update"==e.update?t.update=!0:t.update=!1,t.updatePwd=function(){var e={newPwd:t.newPwd,oldPwd:t.oldPwd};s.update(e).success(function(t){n.go("home")}).error(function(){console.log(1),alert("原密码错误")})},t.submit=function(){t.data={name:t.username,password:t.password},s.in(t.data).success(function(s){"login ok"==s.msg?(sessionStorage.setItem("username",t.username),t.success=!0,n.go("home")):t.success=!1}).error(function(){t.success=!1})}}),app.controller("userManCtr",function(t,n){t.user=[],n.get().success(function(n){t.user=n}),t.del=function(s){var e=confirm("是否删除该用户");if(e){var o={name:t.user[s].name};n.del(o).success(function(){n.get().success(function(n){t.user=n})})}},t.add=function(){var s={name:t.newUser};t.isadmin&&(s.role="admin"),n.add(s).success(function(){n.get().success(function(n){t.user=n}),t.newUser=""})}}),app.controller("classifyManCtr",function(t,n){t.method="update",t.classify=[],t.inClass=[],t.showAlert=!1,n.get().success(function(n){t.classify=n}),t.update=function(n){t.method="update",t.showAlert=!0,t.class=t.classify[n].name,t.inClass=t.classify[n].words.slice(0)},t.del=function(s){var e={name:t.classify[s].name};n.del(e).success(function(){n.get().success(function(n){t.classify=n})})},t.delInClass=function(n){t.inClass.splice(n,1)},t.addItem=function(){t.inClass.push("")},t.cancel=function(){t.showAlert=!1,n.get().success(function(n){t.classify=n})},t.updateConfirm=function(){t.showAlert=!1;var s={name:t.class,words:t.inClass};console.log(s),n.update(s).success(function(){n.get().success(function(n){t.classify=n})})},t.addClass=function(){t.method="add",t.showAlert=!0,t.class="",t.inClass=[""]}}),app.config(function(t,n){n.otherwise("/home"),t.state("home",{url:"/home",views:{"":{templateUrl:"dist/tpls/home.html",controller:"homeCtr"},"nav@home":{templateUrl:"dist/tpls/nav.html",controller:"navCtr"},"content@home":{templateUrl:"dist/tpls/userMan.html",controller:"userManCtr"}}}).state("home.classifyMan",{url:"/classifyMan",views:{"content@home":{templateUrl:"dist/tpls/classifyMan.html",controller:"classifyManCtr"}}}).state("login",{url:"/login/:update",templateUrl:"dist/tpls/login.html",controller:"loginCtr"})}),app.factory("log",function(t){return{in:function(n){return t({method:"post",url:"http://tm.jymao.com/ds/login",data:n})},out:function(){return t({method:"post",url:"http://tm.jymao.com/ds/logout"})},vail:function(){return t({method:"get",url:"http://tm.jymao.com/ds/has-login"})},update:function(n){return t({method:"post",url:"http://tm.jymao.com/ds/user/new-password",data:n})}}}),app.factory("user",function(t){return{get:function(){return t({method:"get",url:"http://tm.jymao.com/ds/g/User"})},del:function(n){return t({method:"DELETE",url:"http://tm.jymao.com/ds/user",data:n})},add:function(n){return t({method:"post",url:"http://tm.jymao.com/ds/user",data:n})},put:function(n){return t({method:"PUT",url:"http://tm.jymao.com/ds/user/new-password",data:n})}}}),app.factory("classify",function(t){var n="http://tm.jymao.com/ds/category";return{get:function(){return t({method:"get",url:"http://tm.jymao.com/ds/g/Category"})},update:function(s){return t({method:"post",url:n,data:s})},del:function(s){return t({method:"DELETE",url:n,data:s})}}});